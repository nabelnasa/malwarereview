# BAB II Menulis _rules_ YARA
By:Nabella Permatasari

_Rules_ YARA mudah untuk ditulis dan difahami. _Syntax_ yang digunakan mengadopsi dari bahasa C. Contohnya sebagai berikut:

```xml
rule dummy
{
  condition
    false
}```

Setiap _rules_ pada YARA diawali dengan kata kunci _rules_ kemudian diikuti dengan identifikasi _rules_.
Karakteristik identifikasi
1. Sesuai dengan ketentuan yang ada dalam bahasa C.
2. Dapat mengandung alfanumerik dan _underscore_, namun di awal kata tidak boleh digit.
3. _Case sensitive_ dan tidak boleh lebih dari 128 karakter.


|all|and|any|ascii|at|condition|contains|
|--|--|--|--|--|--|--|
|encryption|false|filesize|fullword|for|global|in|
|import|include|int8|int16|int32|int8be|int16be|
|int32be|matches|meta|nocase|not|or|of|
|private|rule|strings|them|true|uint8|uint16|
|unit32|uint8be|uint16be|uint32be|wide|xor||

_Rules_ biasanya terdiri dari 2 bagian yaitu definisi `strings` dan `condition`. Bagian `strings` dapat dianulir apabila tidak ada `strings` yang ditemukan, jika bagian `condition` harus selalu ada.

Setiap `strings` memiliki sebuah identifikasi yang berisi sebuah karakter `$` yang diikuti dengan sebuah urutan alfanumerik dan _underscore_, yang mana identifikasi dapat digunakan pada bagian `condition` sesuai dengan `strings` yang saling berhubungan. `strings` dapat didefinisikan dalam bentuk teks maupun heksadesimal. Contohnya:

```js
rule ExampleRule
{
  strings:
    $my_text_string="text here"
    $my_hex_string= { E2 34 A1 08 23 FB }

  condition:
    $my_text_string or $my_hex_string
}
```

Teks dari `string` dinyatakan dengan adanya tanda 2 tanda petik seperti pada penulisan bahasa C. Sedangkan heksadesimal dari `strings` dinyatakan dengan 2 kurung kurawal. Teks diubah menjadi rangkaian bilangan heksadesimal dengan pemisahnya adalah tanda spasi. Bilangan desimal tidak dapat dimasukkan kedalam `hex strings`.

Bagian `condition` adalah letak dari rule logika. Bagian ini berisi sebuah ekspresi boolean yang menceritakan tentang keadaan sebuah file atau apakah sebuah proses dipenuhi atau tidak. Secara umum, `condition` akan mengarahkan kepada `strings` yang telah diidentifikasi. Dalam hal ini identifikasi `strings` bertindak sebagai variabel yang bernilai benar jika `strings` ditemukan dalam file atau proses memori, dan bernilai salah jika sebaliknya.

## 2.1 Komentar
Dapat menambahkan komentar pada YARA dengan cara sama dengan komentar yang ada di C. Contohnya:

```
/*
  This is a muti-line comment ...
*/

rule CommentExample // ... and this is single-line comment
{
  condition:
    false // just a dummy rule, don't do this
}
```

## 2.2 Strings
Ada 3 jenis `strings` YARA yaitu,
1. _hexadecimal string_,  untuk mendefinisikan rangkaian raw byte.
2. _text strings_, dan
3. _regular expreessions_ untuk mendefinisikan teks yang terbaca dan merepresentasikan raw byte dalam arti keluar dari rangkaian.

### 2.2.1 Hexadecimal Strings
Pada `strings` heksadesimal dapat menyediakan 3 buah konstruksi khusus yang membuatnya lebih fleksibel yaitu :
1. _Wild-card_ hanya dapat diletakkan pada `string` yang mengindikasikan  beberapa byte tidak diketahui dan harus cocok dengan apapun. Tempat dari karakter ditandai dengan tanda (?). Berikut contohnya:

```
rule WildcardExample
{
  srings:
    $hex_string = { E2 34 ?? C8 A? FB}
  condition:
    $hex_string
}
```
_Wild-card_ merupakan _nibbel-wise_, artinya kamu dapat mendefinisikan hanya 1 nibble byte dan lainnya tetap _unknown_.

_Wild-card_ bermanfaat ketika mendefinisikan `strings` yang dapat berubah-ubah namun diketahui panjang dari potongan variabelnya, namun tidak selalu hal ini terjadi. Pada beberapa keadaan dibutuhkan potongan dari panjang dan konten `string`. Pada situasi ini dapat menggunakan **jumps** pada **wild-card**. Contohnya

```
rule JumpExample
{
  strings:
    $hex_string = { F4 23 [4-6] 62 B4 }

  condition:
    $hex_string
}
```
Pada contoh diatas terdapat sebuah pasangan bilangan di dalam kurung siku, hal ini merupakan `jump`. `Jump` mengindikasikan bahwa terdapat rangkaian byte yang berubah-ubah dari 4-6 yang dapat menempati posisi dari jump. Beberapa string yang cocok dalam pola tersebut.

```
F4 23 01 02 03 04 62 B4
F4 23 00 00 00 00 00 62 B4
F4 23 15 82 A3 04 45 22 62 B4
```
Jump [X-Y] dengan syarat 0 <= X <= Y. Pada versi YARA sebelumnya, baik X maupun Y harus 256, tapi mulai YARA 2.0 tidak ada batasan untuk X dan Y.

Berikut adalah jump yang valid

```
FE 39 45 [0-8] 89 00
FE 39 45 [23-45] 89 00
FE 39 45 [1000-2000] 89 00
```  

Berikut jump yang tidak valid
```
FE 39 45 [10-7] 89 00
```
Jika batas atas dan batas bawahnya sama, dapat ditulis dengan sebuah bilangan yang ditutup kurung siku

```
FE 39 45 [6] 89 00
```
`string` diatas ekuivalen dengan `string` berikut ini

```
FE 39 45 [6-6] 89 00
FE 39 45 ?? ?? ?? ?? ?? ?? 89 00
```
Mulai YARA 2.0 dapat juga menyatakan bilangan tanpa batas.
```
FE 39 45 [10-] 89 00  //artinya [10-infinitif]
FE 39 45 [-] 89 00    //artinya [0-infinitif]
```
Terdapat juga situasi untuk menyediakan alternafir lain dari fragment `hex string` yang ada. Dalam situasi ini dapat menggunakan _Syntax_
```
rule AlternativesExample1
{
strings:
$hex_string = { F4 23 ( 62 B4 | 56 ) 45 }
condition:
$hex_string
}
```
_rule_ ini memuat F42362B445 or F4235645.

Untuk alternatif lebih dari dua
```
rule AlternativesExample2
{
strings:
$hex_string = { F4 23 ( 62 B4 | 56 | 45 ?? 67 ) 45 }
condition:
$hex_string
}
```
String yang mengandung _wild card_ dapat menjadi bagian dari rangkaian alternatif.

### 2.2.2 Text strings

Modifikasi pada teks string akan dibahas berikut ini.
Text string dapat menggunakan pemisah yang ada di bahasa C seperti berikut.

|\''|Double quote|
|--|--|
|\\|Backslash|
|\L|Horizontal Tab|
|\n|New Line|
|\xdd|Any byte in Hexadecimal notaion|

###### Case-Insensitive strings
Secara default pada YARA adalah case-sensitif, tapi dapat dianulir dengan cara penambahan **nocase** pada akhir string definition. Contohnya:
```
{
  rule WideCharTextExample2
  strings:
          $wide_and_ascii_string = "Borland" wide asciicondition:
          $wide_and_ascii_string
}
```

###### Wide-character strings
untuk mencari `string` yang di encode 2 bytes perkarakter

###### XOR strings
Untuk mencari `string` dengan sebuah byte xor tunggal yang diterapkan.
###### Searching for full word
Modifikasi ini menjamin bahwa string akan cocok hanya jika muncul pada file yang dibatasi dengan karakter non-alphanumeric.

### 2.2.3 _Regular expreessions_
_Regular expreessions_ merupakan fitur yang paling _powerfull_ dalam YARA. Mereka dtetapkan seperti `text string` namun diapit dengan kurung berupa garis miring.

```
rule RegExpExample1
{
  strings:
    $re1 = /md5: [0-9a-fA-F]{32}/     
$re2 = /state: (on|off)/
condition:
$re1 and $re2
```

## 2.3 Condition
